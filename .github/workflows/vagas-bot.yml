name: Bot Vagas TI

on:
  schedule:
    # ‚è∞ HOR√ÅRIOS AGENDADOS (UTC)
    # 11h UTC = 8h Bras√≠lia | 14h UTC = 11h Bras√≠lia | 17h UTC = 14h Bras√≠lia | 20h UTC = 17h Bras√≠lia | 23h UTC = 20h Bras√≠lia
    - cron: '0 11,14,17,20,23 * * *'
  workflow_dispatch:  # Permite executar manualmente

jobs:
  buscar-vagas:
    runs-on: ubuntu-latest
    timeout-minutes: 20
    
    steps:
    - name: üì• Checkout do c√≥digo
      uses: actions/checkout@v4
      
    - name: üêç Configurar Python 3.11
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
        cache: 'pip'
        
    - name: üåê Instalar Chromium
      run: |
        sudo apt-get update
        sudo apt-get install -y chromium-browser
        sudo apt-get install -y libxss1 fonts-liberation xdg-utils
        
    - name: ‚úÖ Verificar instala√ß√µes
      run: |
        echo "‚úÖ Chromium:"
        chromium-browser --version
        echo "‚úÖ ChromeDriver:"
        chromedriver --version
        echo "‚úÖ Python:"
        python --version
        
    - name: üì¶ Instalar depend√™ncias Python
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        
    - name: üöÄ Executar Bot de Vagas
      env:
        DISCORD_WEBHOOK_URL: ${{ secrets.DISCORD_WEBHOOK_URL }}
        LOCAL: "Salvador, BA"
        PYTHONUNBUFFERED: 1
      run: |
        echo "üöÄ Iniciando busca autom√°tica de vagas..."
        echo "Timestamp: $(date)"
        python bot_vagas.py
        
    - name: ‚úÖ Sucesso
      if: success()
      run: |
        echo "‚úÖ Bot executado com sucesso!"
        echo "Pr√≥xima execu√ß√£o no pr√≥ximo hor√°rio agendado"
        
    - name: ‚ùå Notificar Erro
      if: failure()
      run: |
        curl -X POST ${{ secrets.DISCORD_WEBHOOK_URL }} \
          -H 'Content-Type: application/json' \
          -d '{"content":"‚ùå Erro ao executar bot de vagas. Verifique os logs no GitHub Actions."}' || true
